<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='UTF-8'/>
    <title>pomodoro.</title>
    <link rel='stylesheet' href='tomatocss.css'/>
  </head>
  <body onclick="frontZero(document.getElementById('seconds'))">
    <div class='header'>
      <div class='menu'>
        <div class='dropdown'>
          <span id = 'dropdown'>menu &#9662;</span>
          <ul class='features-menu' id = 'features-menu'>
            <li><a href='tomatoh.html'>about</a></li>
            <li><a href='tomatodraft2.html'>get started</a></li>
            <li><a href="https://github.com/ruijinUofM/pomodoro">github</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class = 'contentContainer' id = "content">
      <div class='tomato-container'>
        <div class='tomato'>
          <div class='stem'><img src='method-draw-image (4).svg'/></div>

          <div id = 'fruit'></div>

        </div>
      </div>
      <div class='timer-container'>
        <div id = "pomodoroCount">
          pomodoros:
          <input type = "number" name = "pomodoroControl" id = "pomodoroControl" min = "0" max = "3" value = "0">
          <div id = "pomodoroDisplay">
            0
          </div>
        </div>
        <script>
          function frontZero(digit) {
            if(digit.value.length == 1) {
              digit.value = '0' + digit.value;
            }
          }
        </script>
        <div id = 'timer'>
          <input type = "number" name = "minutes" id = "minutes" min = "0" max = "60" value = "25">
          :
          <input type = "number" name = "seconds" id = "seconds" min = "0" max = "59" value="00"
            onclick="frontZero(this)">
        </div>

        <div id = 'timerDisplay' >
          <div class = "timerNum" id = "minutesNum"></div>
          :
          <div class = "timerNum" id = "secondsNum"></div>
        </div>

        <div id = "control">
          Start
        </div>

        <div id = "rest">
          Work
        </div>

      </div>
    </div>
    <script>

      var control = document.getElementById("control");
      var timerInterval;
      var minutes = 25;
      var seconds = 0;
      var pomodoroCounter = 0;
      var breakTime = false;
      var startStop = true;
      var fruit = document.getElementById("fruit");
      var dropCount = false;
      var natural = true;
      function fruitRipen(x) {
        reset();
        fruit.style.animation = "ripen " + x + "s ease-in forwards";
      }

      function fruitDrop() {
        if (!dropCount) {
          fruit.style.animation += ", fruitfall .5s ease-in forwards";
          dropCount = true;
        }
      }

      function grow(x) {
        reset();
        fruit.style.animation = "grow " + x +"s ease-in forwards";
      }

      function pause() {
        if(!natural || breakTime) {
          fruitDrop();
        }
        if(!breakTime && !natural) {
          setTimeout(grow, 500, 1);
        }
          natural = true;
      }

      function reset() {
        fruit.style.animation = "none";
        fruit.offsetHeight;
        fruit.style.animation = null;
        dropCount = false;
      }

      function breakTimeReset() {
        if (breakTime) {
          document.getElementById('rest').innerHTML = "Break";
        }
        else {
          document.getElementById('rest').innerHTML = "Work";
        }
      }

      function growOrRipen() {
        var animationSeconds = (60 * minutes) + seconds;
        if (breakTime) {
          grow(animationSeconds);
        }
        else {
          fruitRipen(animationSeconds);
        }
      }

      function startTime() {
        updateTime();
        document.getElementById("minutesNum").innerHTML = minutes;
        if (seconds < 10) {
          document.getElementById("secondsNum").innerHTML = "0" + seconds;
        }
        else {
          document.getElementById("secondsNum").innerHTML = seconds;
        }
       }

      function updateTime() {
        if (minutes == 0 && seconds == 0) {

          clearInterval(timerInterval);

          breakTime = !breakTime;
          breakTimeReset();

          startStop = true;
          pause();

          control.innerHTML = "Start";
          if (breakTime) {
            if (++pomodoroCounter == 4) {
              minutes = 15;
              pomodoroCounter = 0;
            }
            else {
              minutes = 3;
            }
          }
          else {
            minutes = 25;
          }
          document.getElementById('pomodoroControl').value = pomodoroCounter;
          document.getElementById('pomodoroDisplay').innerHTML = pomodoroCounter;
          document.getElementById('minutes').value = minutes;
          document.getElementById('seconds').value = "00";

          document.getElementById('timer').style.zIndex = '1';
          document.getElementById('pomodoroControl').style.zIndex = '1';

        }
        else if (seconds == 0) {
          seconds = 59;
          --minutes;
         }
         else {
          --seconds;
         }
      }

      control.addEventListener("click", function()
        {
          if (startStop) {
            pomodoroCounter = document.getElementById('pomodoroControl').value;
            document.getElementById('pomodoroDisplay').innerHTML = pomodoroCounter;
            minutes = document.getElementById('minutes').value;
            seconds = document.getElementById('seconds').value;
            if(seconds.length >= 3) {
              seconds = seconds.substring(seconds.length - 2, seconds.length);
            }

            if(seconds.substring(0,1) == "0") {
              seconds = seconds.substring(1,2);
            }
            startTime();

            growOrRipen();

            timerInterval = setInterval(startTime, 1000);
            startStop = false;
            control.innerHTML = "Pause";
            document.getElementById('timer').style.zIndex = '-1';
            document.getElementById('pomodoroControl').style.zIndex = '-1';
          }

          else {
            natural = false;
            pause();
            document.getElementById('minutes').value = minutes;
            if(seconds < 10) {
              document.getElementById('seconds').value = '0' + seconds;
            }
            else {
              document.getElementById('seconds').value = seconds;
            }
            clearInterval(timerInterval);
            startStop = true;
            control.innerHTML = "Start";
            document.getElementById('timer').style.zIndex = '1';
            document.getElementById('pomodoroControl').style.zIndex = '1';
          }
        }
      );

      document.getElementById("rest").addEventListener("click", function() {
        minutes = 0;
        seconds = 0;
        natural = false;
        updateTime();
      });

      var menuShow = true;
      document.getElementById('dropdown').addEventListener("click", function() {
        if (menuShow) {
          document.getElementById('features-menu').style.display = 'flex';
        }
        else {
          document.getElementById('features-menu').style.display = 'none';
        }
        menuShow = !menuShow;
      });
      document.getElementById('content').addEventListener("click", function() {
        document.getElementById('features-menu').style.display = 'none';
        menuShow = true;
      });
    </script>
  </body>
</html>
